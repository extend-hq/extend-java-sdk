/**
 * Custom wrapper code - not auto-generated by Fern.
 */
package ai.extend.wrapper.resources;

import static org.junit.jupiter.api.Assertions.*;

import ai.extend.types.EditRunStatus;
import ai.extend.types.ParseRunStatusEnum;
import ai.extend.types.ProcessorRunStatus;
import ai.extend.types.WorkflowRunStatus;
import java.util.Arrays;
import java.util.HashSet;
import java.util.Set;
import org.junit.jupiter.api.DisplayName;
import org.junit.jupiter.api.Nested;
import org.junit.jupiter.api.Test;

/**
 * Tests for resource wrapper terminal status logic.
 *
 * Note: Full integration tests for createAndPoll require API mocking
 * and are located in the playground repository.
 */
class ResourceWrappersTest {

    // ============================================================================
    // ProcessorRunStatus terminal status tests (Extract, Classify, Split)
    // ============================================================================

    @Nested
    @DisplayName("ProcessorRunStatus terminal states")
    class ProcessorRunStatusTests {

        private final Set<ProcessorRunStatus> NON_TERMINAL =
                new HashSet<ProcessorRunStatus>(Arrays.asList(ProcessorRunStatus.PROCESSING));

        private boolean isTerminal(ProcessorRunStatus status) {
            return !NON_TERMINAL.contains(status);
        }

        @Test
        @DisplayName("PROCESSING should NOT be terminal")
        void processingNotTerminal() {
            assertFalse(isTerminal(ProcessorRunStatus.PROCESSING));
        }

        @Test
        @DisplayName("PROCESSED should be terminal")
        void processedIsTerminal() {
            assertTrue(isTerminal(ProcessorRunStatus.PROCESSED));
        }

        @Test
        @DisplayName("FAILED should be terminal")
        void failedIsTerminal() {
            assertTrue(isTerminal(ProcessorRunStatus.FAILED));
        }

        @Test
        @DisplayName("CANCELLED should be terminal")
        void cancelledIsTerminal() {
            assertTrue(isTerminal(ProcessorRunStatus.CANCELLED));
        }
    }

    // ============================================================================
    // EditRunStatus terminal status tests
    // ============================================================================

    @Nested
    @DisplayName("EditRunStatus terminal states")
    class EditRunStatusTests {

        private final Set<EditRunStatus> NON_TERMINAL =
                new HashSet<EditRunStatus>(Arrays.asList(EditRunStatus.PROCESSING));

        private boolean isTerminal(EditRunStatus status) {
            return !NON_TERMINAL.contains(status);
        }

        @Test
        @DisplayName("PROCESSING should NOT be terminal")
        void processingNotTerminal() {
            assertFalse(isTerminal(EditRunStatus.PROCESSING));
        }

        @Test
        @DisplayName("PROCESSED should be terminal")
        void processedIsTerminal() {
            assertTrue(isTerminal(EditRunStatus.PROCESSED));
        }

        @Test
        @DisplayName("FAILED should be terminal")
        void failedIsTerminal() {
            assertTrue(isTerminal(EditRunStatus.FAILED));
        }
    }

    // ============================================================================
    // ParseRunStatusEnum terminal status tests
    // ============================================================================

    @Nested
    @DisplayName("ParseRunStatusEnum terminal states")
    class ParseRunStatusEnumTests {

        private final Set<ParseRunStatusEnum> NON_TERMINAL =
                new HashSet<ParseRunStatusEnum>(Arrays.asList(ParseRunStatusEnum.PROCESSING));

        private boolean isTerminal(ParseRunStatusEnum status) {
            return !NON_TERMINAL.contains(status);
        }

        @Test
        @DisplayName("PROCESSING should NOT be terminal")
        void processingNotTerminal() {
            assertFalse(isTerminal(ParseRunStatusEnum.PROCESSING));
        }

        @Test
        @DisplayName("PROCESSED should be terminal")
        void processedIsTerminal() {
            assertTrue(isTerminal(ParseRunStatusEnum.PROCESSED));
        }

        @Test
        @DisplayName("FAILED should be terminal")
        void failedIsTerminal() {
            assertTrue(isTerminal(ParseRunStatusEnum.FAILED));
        }
    }

    // ============================================================================
    // WorkflowRunStatus terminal status tests
    // ============================================================================

    @Nested
    @DisplayName("WorkflowRunStatus terminal states")
    class WorkflowRunStatusTests {

        private final Set<WorkflowRunStatus> NON_TERMINAL = new HashSet<WorkflowRunStatus>(
                Arrays.asList(WorkflowRunStatus.PENDING, WorkflowRunStatus.PROCESSING, WorkflowRunStatus.CANCELLING));

        private boolean isTerminal(WorkflowRunStatus status) {
            return !NON_TERMINAL.contains(status);
        }

        @Test
        @DisplayName("PENDING should NOT be terminal")
        void pendingNotTerminal() {
            assertFalse(isTerminal(WorkflowRunStatus.PENDING));
        }

        @Test
        @DisplayName("PROCESSING should NOT be terminal")
        void processingNotTerminal() {
            assertFalse(isTerminal(WorkflowRunStatus.PROCESSING));
        }

        @Test
        @DisplayName("CANCELLING should NOT be terminal")
        void cancellingNotTerminal() {
            assertFalse(isTerminal(WorkflowRunStatus.CANCELLING));
        }

        @Test
        @DisplayName("PROCESSED should be terminal")
        void processedIsTerminal() {
            assertTrue(isTerminal(WorkflowRunStatus.PROCESSED));
        }

        @Test
        @DisplayName("FAILED should be terminal")
        void failedIsTerminal() {
            assertTrue(isTerminal(WorkflowRunStatus.FAILED));
        }

        @Test
        @DisplayName("CANCELLED should be terminal")
        void cancelledIsTerminal() {
            assertTrue(isTerminal(WorkflowRunStatus.CANCELLED));
        }

        @Test
        @DisplayName("NEEDS_REVIEW should be terminal")
        void needsReviewIsTerminal() {
            assertTrue(isTerminal(WorkflowRunStatus.NEEDS_REVIEW));
        }

        @Test
        @DisplayName("REJECTED should be terminal")
        void rejectedIsTerminal() {
            assertTrue(isTerminal(WorkflowRunStatus.REJECTED));
        }
    }

}
