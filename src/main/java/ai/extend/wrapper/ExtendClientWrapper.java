/**
 * Custom wrapper code - not auto-generated by Fern.
 */
package ai.extend.wrapper;

import ai.extend.ExtendClient;
import ai.extend.core.ClientOptions;
import ai.extend.core.Environment;
import ai.extend.core.Suppliers;
import ai.extend.resources.classifiers.ClassifiersClient;
import ai.extend.resources.classifierversions.ClassifierVersionsClient;
import ai.extend.resources.evaluationsetitems.EvaluationSetItemsClient;
import ai.extend.resources.evaluationsetruns.EvaluationSetRunsClient;
import ai.extend.resources.evaluationsets.EvaluationSetsClient;
import ai.extend.resources.extractors.ExtractorsClient;
import ai.extend.resources.extractorversions.ExtractorVersionsClient;
import ai.extend.resources.files.FilesClient;
import ai.extend.resources.splitters.SplittersClient;
import ai.extend.resources.splitterversions.SplitterVersionsClient;
import ai.extend.resources.workflows.WorkflowsClient;
import ai.extend.wrapper.resources.ClassifyRunsWrapper;
import ai.extend.wrapper.resources.EditRunsWrapper;
import ai.extend.wrapper.resources.ExtractRunsWrapper;
import ai.extend.wrapper.resources.ParseRunsWrapper;
import ai.extend.wrapper.resources.SplitRunsWrapper;
import ai.extend.wrapper.resources.WorkflowRunsWrapper;
import ai.extend.wrapper.webhooks.Webhooks;
import java.util.function.Supplier;

/**
 * Wrapper for the Extend API client with additional polling and webhook utilities.
 * 
 * <h3>Basic Usage</h3>
 * <pre>{@code
 * ExtendClientWrapper client = ExtendClientWrapper.builder()
 *     .apiKey("your-api-key")
 *     .build();
 * 
 * // Create and poll an extract run
 * var response = client.extractRuns().createAndPoll(
 *     ExtractRunsCreateRequest.builder()
 *         .file(...)
 *         .extractor(...)
 *         .build()
 * );
 * }</pre>
 * 
 * <h3>Webhook Verification</h3>
 * <pre>{@code
 * Map<String, Object> event = client.webhooks().verifyAndParse(
 *     requestBody,
 *     requestHeaders,
 *     signingSecret
 * );
 * }</pre>
 */
public class ExtendClientWrapper {
    
    private final ExtendClient client;
    private final Webhooks webhooks;
    
    // Lazy-initialized wrappers
    private final Supplier<ExtractRunsWrapper> extractRunsWrapper;
    private final Supplier<ClassifyRunsWrapper> classifyRunsWrapper;
    private final Supplier<SplitRunsWrapper> splitRunsWrapper;
    private final Supplier<ParseRunsWrapper> parseRunsWrapper;
    private final Supplier<EditRunsWrapper> editRunsWrapper;
    private final Supplier<WorkflowRunsWrapper> workflowRunsWrapper;
    
    private ExtendClientWrapper(ClientOptions clientOptions) {
        this.client = new ExtendClient(clientOptions);
        this.webhooks = new Webhooks();
        
        // Lazy initialization of wrappers
        this.extractRunsWrapper = Suppliers.memoize(() -> new ExtractRunsWrapper(clientOptions));
        this.classifyRunsWrapper = Suppliers.memoize(() -> new ClassifyRunsWrapper(clientOptions));
        this.splitRunsWrapper = Suppliers.memoize(() -> new SplitRunsWrapper(clientOptions));
        this.parseRunsWrapper = Suppliers.memoize(() -> new ParseRunsWrapper(clientOptions));
        this.editRunsWrapper = Suppliers.memoize(() -> new EditRunsWrapper(clientOptions));
        this.workflowRunsWrapper = Suppliers.memoize(() -> new WorkflowRunsWrapper(clientOptions));
    }
    
    /**
     * Returns the underlying ExtendClient for direct API access.
     */
    public ExtendClient getClient() {
        return client;
    }
    
    /**
     * Returns the webhook utilities for signature verification.
     */
    public Webhooks webhooks() {
        return webhooks;
    }
    
    // ========== Run Wrappers with createAndPoll ==========
    
    /**
     * Returns the extract runs wrapper with createAndPoll support.
     */
    public ExtractRunsWrapper extractRuns() {
        return extractRunsWrapper.get();
    }
    
    /**
     * Returns the classify runs wrapper with createAndPoll support.
     */
    public ClassifyRunsWrapper classifyRuns() {
        return classifyRunsWrapper.get();
    }
    
    /**
     * Returns the split runs wrapper with createAndPoll support.
     */
    public SplitRunsWrapper splitRuns() {
        return splitRunsWrapper.get();
    }
    
    /**
     * Returns the parse runs wrapper with createAndPoll support.
     */
    public ParseRunsWrapper parseRuns() {
        return parseRunsWrapper.get();
    }
    
    /**
     * Returns the edit runs wrapper with createAndPoll support.
     */
    public EditRunsWrapper editRuns() {
        return editRunsWrapper.get();
    }
    
    /**
     * Returns the workflow runs wrapper with createAndPoll support.
     */
    public WorkflowRunsWrapper workflowRuns() {
        return workflowRunsWrapper.get();
    }
    
    // ========== Pass-through clients (no wrapper needed) ==========
    
    /**
     * Returns the files client.
     */
    public FilesClient files() {
        return client.files();
    }
    
    /**
     * Returns the extractors client.
     */
    public ExtractorsClient extractors() {
        return client.extractors();
    }
    
    /**
     * Returns the extractor versions client.
     */
    public ExtractorVersionsClient extractorVersions() {
        return client.extractorVersions();
    }
    
    /**
     * Returns the classifiers client.
     */
    public ClassifiersClient classifiers() {
        return client.classifiers();
    }
    
    /**
     * Returns the classifier versions client.
     */
    public ClassifierVersionsClient classifierVersions() {
        return client.classifierVersions();
    }
    
    /**
     * Returns the splitters client.
     */
    public SplittersClient splitters() {
        return client.splitters();
    }
    
    /**
     * Returns the splitter versions client.
     */
    public SplitterVersionsClient splitterVersions() {
        return client.splitterVersions();
    }
    
    /**
     * Returns the workflows client.
     */
    public WorkflowsClient workflows() {
        return client.workflows();
    }
    
    /**
     * Returns the evaluation sets client.
     */
    public EvaluationSetsClient evaluationSets() {
        return client.evaluationSets();
    }
    
    /**
     * Returns the evaluation set items client.
     */
    public EvaluationSetItemsClient evaluationSetItems() {
        return client.evaluationSetItems();
    }
    
    /**
     * Returns the evaluation set runs client.
     */
    public EvaluationSetRunsClient evaluationSetRuns() {
        return client.evaluationSetRuns();
    }
    
    /**
     * Creates a new builder for ExtendClientWrapper.
     */
    public static Builder builder() {
        return new Builder();
    }
    
    /**
     * Builder for {@link ExtendClientWrapper}.
     */
    public static class Builder {
        private String apiKey;
        private Environment environment = Environment.PRODUCTION;
        private String baseUrl;
        
        /**
         * Sets the API key.
         */
        public Builder apiKey(String apiKey) {
            this.apiKey = apiKey;
            return this;
        }
        
        /**
         * Sets the environment.
         * Default: PRODUCTION
         */
        public Builder environment(Environment environment) {
            this.environment = environment;
            return this;
        }
        
        /**
         * Sets a custom base URL (overrides environment).
         */
        public Builder baseUrl(String baseUrl) {
            this.baseUrl = baseUrl;
            return this;
        }
        
        /**
         * Builds the ExtendClientWrapper.
         */
        public ExtendClientWrapper build() {
            ClientOptions.Builder optionsBuilder = ClientOptions.builder();
            
            if (apiKey != null) {
                optionsBuilder.addHeader("Authorization", "Bearer " + apiKey);
            }
            
            if (baseUrl != null) {
                optionsBuilder.environment(Environment.custom(baseUrl));
            } else {
                optionsBuilder.environment(environment);
            }
            
            return new ExtendClientWrapper(optionsBuilder.build());
        }
    }
}
