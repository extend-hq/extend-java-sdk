/**
 * Custom wrapper code - not auto-generated by Fern.
 */
package ai.extend.wrapper.utilities.polling;

import ai.extend.core.RequestOptions;

/**
 * Configuration options for polling operations.
 *
 * <p>By default, polling runs indefinitely until a terminal state is reached.</p>
 *
 * <p>Use the builder pattern to create instances with custom values:</p>
 * <pre>{@code
 * // Polls indefinitely
 * PollingOptions options = PollingOptions.builder().build();
 *
 * // With custom timeout
 * PollingOptions options = PollingOptions.builder()
 *     .maxWaitMs(300000)  // 5 minutes
 *     .build();
 * }</pre>
 */
public class PollingOptions {

    /**
     * Default initial delay between polls: 1 second (1,000 ms).
     */
    public static final int DEFAULT_INITIAL_DELAY_MS = 1_000;

    /**
     * Default maximum delay between polls: 60 seconds (60,000 ms).
     */
    public static final int DEFAULT_MAX_DELAY_MS = 60_000;

    /**
     * Default jitter fraction: 0.25 (±25% randomization).
     */
    public static final double DEFAULT_JITTER_FRACTION = 0.25;

    private final Integer maxWaitMs;  // null = poll indefinitely
    private final int initialDelayMs;
    private final int maxDelayMs;
    private final double jitterFraction;
    private final RequestOptions requestOptions;

    private PollingOptions(Builder builder) {
        this.maxWaitMs = builder.maxWaitMs;
        this.initialDelayMs = builder.initialDelayMs;
        this.maxDelayMs = builder.maxDelayMs;
        this.jitterFraction = builder.jitterFraction;
        this.requestOptions = builder.requestOptions;
    }

    /**
     * Returns the maximum total wait time in milliseconds, or null if polling indefinitely.
     */
    public Integer getMaxWaitMs() {
        return maxWaitMs;
    }

    /**
     * Returns whether a timeout is configured.
     */
    public boolean hasTimeout() {
        return maxWaitMs != null;
    }

    /**
     * Returns the initial delay between polls in milliseconds.
     */
    public int getInitialDelayMs() {
        return initialDelayMs;
    }

    /**
     * Returns the maximum delay between polls in milliseconds.
     */
    public int getMaxDelayMs() {
        return maxDelayMs;
    }

    /**
     * Returns the jitter fraction for delay randomization.
     */
    public double getJitterFraction() {
        return jitterFraction;
    }

    /**
     * Returns the request options to pass to API calls.
     */
    public RequestOptions getRequestOptions() {
        return requestOptions;
    }

    /**
     * Creates a new builder with default values.
     */
    public static Builder builder() {
        return new Builder();
    }

    /**
     * Creates default polling options (polls indefinitely).
     */
    public static PollingOptions defaults() {
        return new Builder().build();
    }

    /**
     * Builder for {@link PollingOptions}.
     */
    public static class Builder {
        private Integer maxWaitMs = null;  // null = poll indefinitely
        private int initialDelayMs = DEFAULT_INITIAL_DELAY_MS;
        private int maxDelayMs = DEFAULT_MAX_DELAY_MS;
        private double jitterFraction = DEFAULT_JITTER_FRACTION;
        private RequestOptions requestOptions;

        /**
         * Sets the maximum total wait time in milliseconds.
         * Default: null (polls indefinitely)
         */
        public Builder maxWaitMs(int maxWaitMs) {
            this.maxWaitMs = maxWaitMs;
            return this;
        }

        /**
         * Sets the initial delay between polls in milliseconds.
         * Default: 1000 (1 second)
         */
        public Builder initialDelayMs(int initialDelayMs) {
            this.initialDelayMs = initialDelayMs;
            return this;
        }

        /**
         * Sets the maximum delay between polls in milliseconds.
         * Default: 60000 (60 seconds)
         */
        public Builder maxDelayMs(int maxDelayMs) {
            this.maxDelayMs = maxDelayMs;
            return this;
        }

        /**
         * Sets the jitter fraction for delay randomization.
         * A value of 0.25 means delays will be randomized by ±25%.
         * Default: 0.25
         */
        public Builder jitterFraction(double jitterFraction) {
            this.jitterFraction = jitterFraction;
            return this;
        }

        /**
         * Sets the request options to pass to API calls.
         */
        public Builder requestOptions(RequestOptions requestOptions) {
            this.requestOptions = requestOptions;
            return this;
        }

        /**
         * Builds the {@link PollingOptions} instance.
         */
        public PollingOptions build() {
            return new PollingOptions(this);
        }
    }
}
