/**
 * Custom wrapper code - not auto-generated by Fern.
 */
package ai.extend.wrapper.webhooks;

import java.util.Map;

/**
 * Result of verifying and parsing a webhook event.
 *
 * <p>This class provides type-safe access to the parsed webhook event,
 * which can be either a normal event or a signed URL event.</p>
 *
 * <h3>Usage</h3>
 * <pre>{@code
 * VerifyAndParseResult result = webhooks.verifyAndParse(body, headers, secret, options);
 *
 * if (result.isSignedUrlEvent()) {
 *     WebhookEventWithSignedUrl signedEvent = result.getSignedUrlEvent();
 *     // Fetch the full payload
 *     Map<String, Object> fullEvent = webhooks.fetchSignedPayload(signedEvent);
 * } else {
 *     Map<String, Object> event = result.getEvent();
 *     // Process the event
 * }
 * }</pre>
 */
public class VerifyAndParseResult {

    private final Map<String, Object> event;
    private final WebhookEventWithSignedUrl signedUrlEvent;

    private VerifyAndParseResult(Map<String, Object> event, WebhookEventWithSignedUrl signedUrlEvent) {
        this.event = event;
        this.signedUrlEvent = signedUrlEvent;
    }

    /**
     * Creates a result for a normal webhook event.
     */
    public static VerifyAndParseResult ofEvent(Map<String, Object> event) {
        return new VerifyAndParseResult(event, null);
    }

    /**
     * Creates a result for a signed URL webhook event.
     */
    public static VerifyAndParseResult ofSignedUrlEvent(WebhookEventWithSignedUrl signedUrlEvent) {
        return new VerifyAndParseResult(null, signedUrlEvent);
    }

    /**
     * Returns true if this is a signed URL event.
     */
    public boolean isSignedUrlEvent() {
        return signedUrlEvent != null;
    }

    /**
     * Returns the parsed webhook event.
     *
     * @return The event map, or null if this is a signed URL event
     * @throws IllegalStateException if this is a signed URL event
     */
    public Map<String, Object> getEvent() {
        if (isSignedUrlEvent()) {
            throw new IllegalStateException(
                    "Cannot call getEvent() on a signed URL event. Use getSignedUrlEvent() instead.");
        }
        return event;
    }

    /**
     * Returns the signed URL event.
     *
     * @return The signed URL event, or null if this is a normal event
     * @throws IllegalStateException if this is not a signed URL event
     */
    public WebhookEventWithSignedUrl getSignedUrlEvent() {
        if (!isSignedUrlEvent()) {
            throw new IllegalStateException(
                    "Cannot call getSignedUrlEvent() on a normal event. Use getEvent() instead.");
        }
        return signedUrlEvent;
    }

    /**
     * Returns the event ID from either event type.
     */
    public String getEventId() {
        if (isSignedUrlEvent()) {
            return signedUrlEvent.getEventId();
        }
        return (String) event.get("eventId");
    }

    /**
     * Returns the event type from either event type.
     */
    public String getEventType() {
        if (isSignedUrlEvent()) {
            return signedUrlEvent.getEventType();
        }
        return (String) event.get("eventType");
    }
}
