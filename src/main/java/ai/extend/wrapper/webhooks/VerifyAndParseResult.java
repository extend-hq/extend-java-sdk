/**
 * Custom wrapper code - not auto-generated by Fern.
 */
package ai.extend.wrapper.webhooks;

import ai.extend.types.WebhookEvent;

/**
 * Result of verifying and parsing a webhook event.
 *
 * <p>This class provides type-safe access to the parsed webhook event,
 * which can be either a normal typed event or a signed URL event.</p>
 *
 * <h3>Usage</h3>
 * <pre>{@code
 * VerifyAndParseResult result = webhooks.verifyAndParseWithOptions(body, headers, secret, options);
 *
 * if (result.isSignedUrlEvent()) {
 *     WebhookEventWithSignedUrl signedEvent = result.getSignedUrlEvent();
 *     WebhookEvent fullEvent = webhooks.fetchSignedPayload(signedEvent);
 * } else {
 *     WebhookEvent event = result.getEvent();
 *     event.visit(new WebhookEvent.Visitor<Void>() { ... });
 * }
 * }</pre>
 */
public class VerifyAndParseResult implements RawWebhookEvent {

    private final WebhookEvent event;
    private final String eventId;
    private final String eventType;
    private final WebhookEventWithSignedUrl signedUrlEvent;

    private VerifyAndParseResult(
            WebhookEvent event, String eventId, String eventType, WebhookEventWithSignedUrl signedUrlEvent) {
        this.event = event;
        this.eventId = eventId;
        this.eventType = eventType;
        this.signedUrlEvent = signedUrlEvent;
    }

    /**
     * Creates a result for a normal webhook event.
     */
    public static VerifyAndParseResult ofEvent(WebhookEvent event, String eventId, String eventType) {
        return new VerifyAndParseResult(event, eventId, eventType, null);
    }

    /**
     * Creates a result for a signed URL webhook event.
     */
    public static VerifyAndParseResult ofSignedUrlEvent(WebhookEventWithSignedUrl signedUrlEvent) {
        return new VerifyAndParseResult(null, null, null, signedUrlEvent);
    }

    /**
     * Returns true if this is a signed URL event.
     */
    public boolean isSignedUrlEvent() {
        return signedUrlEvent != null;
    }

    /**
     * Returns the parsed webhook event.
     *
     * @return The typed webhook event
     * @throws IllegalStateException if this is a signed URL event
     */
    public WebhookEvent getEvent() {
        if (isSignedUrlEvent()) {
            throw new IllegalStateException(
                    "Cannot call getEvent() on a signed URL event. Use getSignedUrlEvent() instead.");
        }
        return event;
    }

    /**
     * Returns the signed URL event.
     *
     * @return The signed URL event
     * @throws IllegalStateException if this is not a signed URL event
     */
    public WebhookEventWithSignedUrl getSignedUrlEvent() {
        if (!isSignedUrlEvent()) {
            throw new IllegalStateException(
                    "Cannot call getSignedUrlEvent() on a normal event. Use getEvent() instead.");
        }
        return signedUrlEvent;
    }

    /**
     * Returns the event ID from either event type.
     */
    public String getEventId() {
        if (isSignedUrlEvent()) {
            return signedUrlEvent.getEventId();
        }
        return eventId;
    }

    /**
     * Returns the event type from either event type.
     */
    public String getEventType() {
        if (isSignedUrlEvent()) {
            return signedUrlEvent.getEventType();
        }
        return eventType;
    }
}
